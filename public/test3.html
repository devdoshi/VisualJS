<html>
    <!-- HMTL Headers and iclude all external JS scripts and stuff -->
    <head>
        <meta http-equiv="X-UA-Compatible"  content="IE=edge" />
        <meta name="viewport"    Content-Type="text/javascript; charset=utf-8" content="initial-scale=1.0, width=device-width, height=device-height, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no" />
        <meta charset="UTF-8" />


        <!-- JS libraries and where they come from originally -->
        <linkfrom       rel="stylesheet" href="https://cdn.usebootstrap.com/bootstrap/4.1.3/css/bootstrap.min.css"></linkfrom>
        <scriptfrom     src="https://unpkg.com/vue@3.4.21/dist/vue.global.js">                                  </scriptfrom>
        <scriptfrom     src="https://cdn.jsdelivr.net/npm/alasql@4">                                            </scriptfrom>
        <scriptfrom     src="https://cdn.jsdelivr.net/npm/acorn@latest/dist/acorn.min.js">                      </scriptfrom>


        <!-- Locally cached copies of the external JS libraries (so that we can do development offline) -->
        <link       rel="stylesheet" href="/js_libs/bootstrap4.1.3.css">                                    </link>
        <script     src="/js_libs/vue.global.js">                                                           </script>
        <script     src="/js_libs/alasql4.js">                                                              </script>
        <script     src="/js_libs/acorn.min.js">                                                            </script>


        <!-- JS lib that only works Inline in the HTML -->

        <style>
        .ace_gutter-cell.ace_breakpoint{
        border-radius: 20px 0px 0px 20px;
        /* Change the color of the breakpoint if you want */
        box-shadow: 0px 0px 1px 1px #248c46 inset;
        }
        </style>

        <style>
            .highlight {
                background-color: yellow;
            }
            .hint {
                display: none;
                position: absolute;
                background-color: #333;
                color: white;
                padding: 5px;
                border-radius: 3px;
                z-index: 1000;
            }
            .highlight-character {
                background-color: gray;
                position: absolute;
                z-index: -2000;
            }
        </style>
        <style>
            /* Custom CSS to change the active line highlight color */
            .ace_editor .ace_marker-layer .ace_active-line {
                background: lightblue /* Yellow highlight with 30% opacity */
            }
        </style>
    </head>

    <!-- Start of the HTML to host the main Vue app -->
    <body>
        <div style="margin-top:20px">
            <div id="vue_root_element"></div>
        </div>
    </body>

    <!-- Start of all code in the script tag-->
    <script>
        async function  init                                (  )                                                {
            await useIdeTools()
        }
        function        alaSqlStuff                         (  )                                                {
            alasql("CREATE TABLE test (language INT, hello STRING)");
            alasql.fn.verify = function(r) {
                return true; // Do not insert on this number
            };
            alasql('CREATE TRIGGER mytrigger BEFORE INSERT ON test verify');
            alasql("INSERT INTO test VALUES (1,'Hello!')");
            alasql("INSERT INTO test VALUES (2,'Aloha!')");
            alasql("INSERT INTO test VALUES (3,'Bonjour!')");
            console.log( alasql("SELECT * FROM test WHERE language > 1") );

            alasql("create view testview (name) as select * from test ;")
            alasql.fn.verify2 = function(r) {
                return true; // Do not insert on this number
            };
            alasql('CREATE TRIGGER mytrigger AFTER update ON testview verify2');
            alasql("INSERT INTO test VALUES (4,'Velkommen!')");
            console.log( alasql("SELECT * FROM testview ") );
        }
        async function  useIdeTools                         (  )                                                {
            let promise = new Promise(returnfn => {
                let loadIdeToolsLibScript = document.createElement('script');
                loadIdeToolsLibScript.src = "/js_libs/idetools.js";
                document.head.appendChild(loadIdeToolsLibScript);
                loadIdeToolsLibScript.onload = function () {
                    try {
                    } catch (error) {
                    }
                    returnfn()
                };
            })
            let ret = await promise
        }
        function        createVueUI                    (  )                                                {
            vueApp = Vue.createApp({
                template:                       `
<div style="margin: 20px; font-size: 11px;">
    <div>


        <span  v-if="rightPane=='canvas'" style="width:49%;display: inline-block; border: 1px solid black; vertical-align: top;height: 50%;" id="preview" >
            <b>Canvas</b>
            <canvas id=canvas style="overflow: scroll;height:95%">

            </canvas>
        </span>
    </div>                         \`,


    <div style="margin-top: 20px;">
        <button   v-on:click="dummy()"
                  type="button"
                  style="margin-right: 10px;"
                  class="btn btn-sm btn-info">
            Dummy
        </button>
    </div>
</div>                         `,
                data:                           function        (  )                        {
                    return {
                        rightPane:                  "canvas",
                    }
                },
                mounted:                        async function  (  )                        {
                    let mm = this

                    let c = document.getElementById("canvas");
                    var ctx = c.getContext("2d");
                    ctx.moveTo(0, 0);
                    ctx.lineTo(200, 100);
                    ctx.stroke();
                },
                methods:                        {
                }
            })
        }
        function        mountDebuggerVueElement             (  )                                                {
            Vue.nextTick(function () {
                setTimeout(async function () {
                    VueAppData = vueApp.mount("#vue_root_element")
                    console.log("main app mounted")

                }, 1000)
            })
        }
        function        sleep                               (  ms  )                                            {
            return new Promise(resolve => setTimeout(resolve, ms));
        }
        async function  runAll                              (  )                                                {
            await init()
            await alaSqlStuff()
            await createVueUI();
            await mountDebuggerVueElement();
        }
        let globalWatchList     = {}
        let refData             = Vue.ref({a: 1})
        let vueApp              = null
        let VueAppData          = null


        runAll();

    </script>
</html>
